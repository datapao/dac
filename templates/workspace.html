{% extends "index.html" %}
{% block content %}

<h1 class="title">Workspace: {{ workspace.name }}</h1>
<h1 class="subtitle">{{ workspace.id }}</h1>


<section class="section">
    <h3 class="title is-3">Deatils and Costs</h3>
    <div class="columns">
        <div class="column is-half">
            <table class="table">
                <tr>
                    <th>Type</th>
                    <td>{{workspace.type}}</td>
                </tr>
                <tr>
                    <th>Clusters</th>
                    <td>{{workspace.clusters | length}}</td>
                </tr>
                <tr>
                    <th>Active Clusters</th>
                    <td>{{workspace.active_clusters() | length}}</td>
                </tr>
            </table>
        </div>



        <div class="column is-half">
            <div class="columns">

                <div class="column">
                    <table class="table">
                        <tr>
                            <th>Running time (total)</th>
                            <td>{{cost.interval | round(1, 'common')}} h</td>
                        </tr>
                        <tr>
                            <th>Total DBU (total)</th>
                            <td>{{cost.interval_dbu | round(1, 'common')}}</td>
                        </tr>
                        <tr>
                            <th>Running time (7 days)</th>
                            <td>{{cost.weekly_interval_sum | round(1, 'common')}} h</td>
                        </tr>
                        <tr>
                            <th>Total DBU (7 days)</th>
                            <td>{{cost.weekly_interval_dbu_sum | round(1, 'common')}}</td>
                        </tr>
                    </table>

                </div>


            </div>


        </div>

    </div>

</section>

<h3 class="title is-3">Trends</h3>
<div class="columns">
    <div class="column is-half">
        <canvas id="chart-price"></canvas>
    </div>
    <div class="column is-half">
        <canvas id="chart-clusters"></canvas>
    </div>
</div>
<div class="columns">
    <div class="column is-half">
        <canvas id="chart-active-clusters"></canvas>
    </div>
    <div class="column is-half">
        <canvas id="chart-worker-hours"></canvas>
    </div>

</div>



<h3 class="title is-3">Clusters</h3>
<section class="section">
    <table class="table is-hoverable is-fullwidth">
        <thead>
            <tr>
                <td>Name</td>
                <td>State</td>
                <td>ID</td>
                <td>Workspace</td>
                <td>Driver type</td>
                <td>Worker type</td>
                <td>Workers</td>
                <td>DBU cost / hour</td>
                <td>HW cost / hour</td>
                <td>Cost / hour</td>
            </tr>
        <tbody>
            {%for cluster in workspace.clusters%}
            <tr>
                <td><a href={{ url_for("view_cluster", cluster_id=cluster.cluster_id)}}>{{cluster.cluster_name}}</a>
                </td>
                <td>{{cluster.state}}</td>
                <td>{{cluster.cluster_id}}</td>
                <td><a href="/workspaces">{{cluster.workspace.id}}</a></td>
                <td>{{cluster.driver_type}}</td>
                <td>{{cluster.worker_type}}</td>
                <td>{{cluster.num_workers}}</td>
                <td>{{cluster.dbu_cost_per_hour}}</td>
                <td>{{cluster.hw_cost_per_hour}}</td>
                <td>{{cluster.cost_per_hour}}</td>
            </tr>
            {% endfor %}

        </tbody>


        </tr>
        </thead>
    </table>
</section>


<script>

    var time_stats = JSON.parse('{{ time_stats | tojson | safe}}');

    interval_dbu_sum = time_stats.map(({ interval_dbu_sum }) => interval_dbu_sum)
    interval_sum = time_stats.map(({ interval_sum }) => interval_sum)
    worker_hours_sum = time_stats.map(({ worker_hours_sum }) => worker_hours_sum)
    labels = time_stats.map(({ ts }) => ts)
    console.log(time_stats)

    var ctx = document.getElementById('chart-price').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Total DBU',
                data: interval_dbu_sum,
                backgroundColor: '#7B8CDE',
                borderColor: '#7B8CDE',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });

    var ctx = document.getElementById('chart-clusters').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Running time (hours)',
                data: interval_sum,
                fill: false,
                borderColor: '#7B8CDE',
                borderWidth: 2
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });

    var ctx = document.getElementById('chart-active-clusters').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Active clusters',
                data: [],
                backgroundColor: '#7B8CDE',
                borderColor: '#7B8CDE',
                borderWidth: 2
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
    var ctx = document.getElementById('chart-worker-hours').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Worker hours',
                data: worker_hours_sum,
                backgroundColor: '#7B8CDE',
                borderColor: '#7B8CDE',
                borderWidth: 2
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
</script>


{% endblock %}